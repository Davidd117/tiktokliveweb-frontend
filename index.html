<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TikTok Live R/Place</title>
<style>
body { background:#111; color:white; font-family:Arial; text-align:center; }
#canvasContainer { width:800px;height:800px;margin:20px auto;border:2px solid #444;background:#222;overflow:hidden;cursor:grab;}
canvas { width:100%;height:100%;display:block; }
</style>
</head>
<body>
<h2>TikTok Live R/Place</h2>
<button id="getTokenBtn">Generate Token</button>
<div id="tokenDisplay">Token will appear here</div>
<div id="status">Not verified</div>

<div id="canvasContainer"><canvas id="canvas"></canvas></div>

<script>
const session = 'session_'+Math.random().toString(36).substr(2,8);
const ws = new WebSocket("wss://your-backend-url"); // <-- replace

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const size = 1000;
canvas.width = canvas.clientWidth;
canvas.height = canvas.clientHeight;
const pixels = new Uint8Array(size*size);

let scale=1, offsetX=0, offsetY=0, dragging=false, lastX, lastY;
let verified=false;

function draw(){
  ctx.setTransform(scale,0,0,scale,offsetX,offsetY);
  ctx.fillStyle="#222"; ctx.fillRect(0,0,size,size);
  for(let i=0;i<pixels.length;i++){
    if(pixels[i]){
      const x=i%size, y=Math.floor(i/size);
      ctx.fillStyle="#4ce0ff";
      ctx.fillRect(x,y,1,1);
    }
  }
}
draw();

document.getElementById("getTokenBtn").onclick = ()=>{
  ws.send(JSON.stringify({action:"get_token",session}));
};

canvas.addEventListener("click",e=>{
  if(!verified){ alert("Not verified"); return; }
  const x=Math.floor((e.offsetX-offsetX)/scale);
  const y=Math.floor((e.offsetY-offsetY)/scale);
  if(x>=0 && y>=0 && x<size && y<size){
    ws.send(JSON.stringify({action:"place_pixel",session,index:x+y*size}));
  }
});

ws.onmessage = e=>{
  const msg = JSON.parse(e.data);
  if(msg.type=="token") document.getElementById("tokenDisplay").textContent = msg.token;
  if(msg.type=="verified") { verified=true; document.getElementById("status").textContent="Verified! Place 1 pixel"; }
  if(msg.type=="pixel") { pixels[msg.index]=1; draw(); }
  if(msg.type=="clear"){ pixels.fill(0); draw(); }
  if(msg.type=="error") alert(msg.message);
};
</script>
</body>
</html>
